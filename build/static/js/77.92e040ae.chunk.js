"use strict";(self.webpackChunkportal_app=self.webpackChunkportal_app||[]).push([[77],{27839:(e,t,a)=>{a.r(t),a.d(t,{default:()=>b});var s=a(22555),r=a(65043),n=a(73216),o=a(85442),i=a(61816),l=a(89531),c=a(38010),d=a(7449),u=a(62811),m=a(18662),x=a(79248),p=a(18299),h=a(48970),f=a(75402),g=a(70579);const b=()=>{var e,t;const a=(0,n.Zp)(),{companyId:b}=(0,n.g)(),[y,v]=(0,r.useState)([]),[w]=(0,f.M)("userEmail",""),[N]=(0,f.M)("userRole",null),[j,k]=(0,f.M)("selectedCompanyId",null),[C,A]=(0,r.useState)([]),[D,S]=(0,r.useState)(null),[_,M]=(0,r.useState)(!0),[F,z]=(0,r.useState)(""),[L,I]=(0,r.useState)(!1),[E,T]=(0,r.useState)({customerName:"",dueDateFrom:"",dueDateTo:"",unpaidAmountMin:"",unpaidAmountMax:"",invoiceNumber:""});(0,r.useEffect)(()=>{N&&w&&V()},[N,w]),(0,r.useEffect)(()=>{b&&!j&&k(Number(b))},[b,j]),(0,r.useEffect)(()=>{j&&(Z(),K())},[j]);const V=async()=>{try{let e="/api/companies";"user"===N?e="/api/companies/user/".concat(w):"accountant"===N&&(e="/api/companies/accountant/".concat(w));const t=await fetch(e),a=await t.json();v(a),a.length>0&&!b&&!j&&k(a[0].id)}catch(e){console.error("Chyba pri na\u010d\xedtan\xed firiem:",e)}},Z=async()=>{if(j)try{M(!0);const e=await p.B.getIssuedInvoices(j,{limit:100});A(e),e.length>0&&S(e[0])}catch(e){console.error("Chyba pri na\u010d\xedtan\xed fakt\xfar:",e)}finally{M(!1)}},B=e=>{if(!e||""===e)return"-";try{const t=new Date(e);return isNaN(t.getTime())?"-":t.toLocaleDateString("sk-SK")}catch(t){return"-"}},H=e=>null===e||void 0===e||isNaN(e)?"-":new Intl.NumberFormat("sk-SK",{style:"currency",currency:"EUR"}).format(e),O=C.filter(e=>{var t,a,s,r,n;if(!((null===(t=e.invoice_number)||void 0===t?void 0:t.toLowerCase().includes(F.toLowerCase()))||(null===(a=e.customer_name)||void 0===a?void 0:a.toLowerCase().includes(F.toLowerCase()))||(null===(s=e.varsym)||void 0===s?void 0:s.toLowerCase().includes(F.toLowerCase()))))return!1;if(E.customerName&&(null===(r=e.customer_name)||void 0===r||!r.toLowerCase().includes(E.customerName.toLowerCase())))return!1;if(E.invoiceNumber&&(null===(n=e.invoice_number)||void 0===n||!n.toLowerCase().includes(E.invoiceNumber.toLowerCase())))return!1;if(E.dueDateFrom){if(new Date(e.due_date)<new Date(E.dueDateFrom))return!1}if(E.dueDateTo){if(new Date(e.due_date)>new Date(E.dueDateTo))return!1}const o=parseFloat(String(e.kc_likv||0))||0;if(E.unpaidAmountMin){if(o<parseFloat(E.unpaidAmountMin))return!1}if(E.unpaidAmountMax){if(o>parseFloat(E.unpaidAmountMax))return!1}return!0}),P=(e,t)=>{T(a=>(0,s.A)((0,s.A)({},a),{},{[e]:t}))},K=async()=>{if(j)try{await p.B.refreshInvoicesFromMdb(j),await Z()}catch(e){console.error("Chyba pri obnoven\xed fakt\xfar:",e),alert("Chyba pri obnoven\xed fakt\xfar")}};return(0,g.jsxs)("div",{className:"min-h-screen bg-gray-50 dark:bg-dark-900",children:[(0,g.jsx)("div",{className:"bg-white dark:bg-dark-800 shadow-sm border-b border-gray-200 dark:border-gray-700",children:(0,g.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,g.jsxs)("div",{className:"flex items-center justify-between h-16",children:[(0,g.jsx)("div",{className:"flex items-center",children:(0,g.jsxs)("button",{onClick:()=>a("/accounting"),className:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[(0,g.jsx)(o.A,{className:"h-4 w-4 mr-2"}),"Sp\xe4\u0165 na \xda\u010dtovn\xedctvo"]})}),(0,g.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,g.jsx)("h1",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Vydan\xe9 fakt\xfary"}),y.length>0&&j&&(0,g.jsxs)("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Firma: ",null===(e=y.find(e=>e.id===j))||void 0===e?void 0:e.name," (I\u010cO: ",null===(t=y.find(e=>e.id===j))||void 0===t?void 0:t.ico,")"]})]})]})})}),(0,g.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:(0,g.jsxs)("div",{className:"flex flex-col",style:{height:"calc(100vh - 200px)"},children:[(0,g.jsx)("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border-b border-blue-200",style:{height:"200px",overflow:"hidden"},children:(0,g.jsx)("div",{className:"p-4",children:(0,g.jsx)(h.A,{invoices:O,type:"issued"})})}),(0,g.jsxs)("div",{className:"bg-white overflow-hidden flex flex-col",style:{height:"calc(100vh - 400px)",maxHeight:"700px"},children:[(0,g.jsx)("div",{className:"px-6 py-4 border-b border-gray-200 bg-gradient-to-r from-gray-50 to-gray-100 flex-shrink-0",children:(0,g.jsxs)("div",{className:"flex items-center justify-between",children:[(0,g.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,g.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Zoznam vydan\xfdch fakt\xfar"}),(0,g.jsxs)("button",{onClick:()=>I(!L),className:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md ".concat(L?"text-white bg-blue-600 hover:bg-blue-700":"text-gray-700 bg-white hover:bg-gray-50"," focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"),children:[(0,g.jsx)(c.A,{className:"h-4 w-4 mr-2"}),"Filtre"]})]}),(0,g.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,g.jsxs)("div",{className:"relative",children:[(0,g.jsx)(d.A,{className:"h-5 w-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),(0,g.jsx)("input",{type:"text",placeholder:"H\u013eada\u0165 fakt\xfary...",value:F,onChange:e=>z(e.target.value),className:"pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,g.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,g.jsxs)("button",{onClick:K,className:"inline-flex items-center px-3 py-2 border border-blue-300 shadow-sm text-sm leading-4 font-medium rounded-md text-blue-700 bg-white hover:bg-blue-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[(0,g.jsx)(i.A,{className:"h-4 w-4 mr-1"}),"Obnovi\u0165"]}),(0,g.jsxs)("button",{onClick:()=>{console.log("Vytvori\u0165 nov\xfa fakt\xfaru"),alert("Vytvori\u0165 nov\xfa fakt\xfaru")},className:"inline-flex items-center px-3 py-2 border border-transparent shadow-sm text-sm leading-4 font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[(0,g.jsx)(m.A,{className:"h-4 w-4 mr-1"}),"Nov\xe1 fakt\xfara"]})]})]})]})}),L&&(0,g.jsxs)("div",{className:"px-6 py-4 border-b border-gray-200 bg-gray-50",children:[(0,g.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[(0,g.jsxs)("div",{children:[(0,g.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Firma"}),(0,g.jsx)("input",{type:"text",value:E.customerName,onChange:e=>P("customerName",e.target.value),placeholder:"Zadajte n\xe1zov firmy...",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"\u010c\xedslo fakt\xfary"}),(0,g.jsx)("input",{type:"text",value:E.invoiceNumber,onChange:e=>P("invoiceNumber",e.target.value),placeholder:"Zadajte \u010d\xedslo fakt\xfary...",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Splatn\xe9 od"}),(0,g.jsx)("input",{type:"date",value:E.dueDateFrom,onChange:e=>P("dueDateFrom",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Splatn\xe9 do"}),(0,g.jsx)("input",{type:"date",value:E.dueDateTo,onChange:e=>P("dueDateTo",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Doplatok od (\u20ac)"}),(0,g.jsx)("input",{type:"number",step:"0.01",value:E.unpaidAmountMin,onChange:e=>P("unpaidAmountMin",e.target.value),placeholder:"0.00",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Doplatok do (\u20ac)"}),(0,g.jsx)("input",{type:"number",step:"0.01",value:E.unpaidAmountMax,onChange:e=>P("unpaidAmountMax",e.target.value),placeholder:"999999.99",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]})]}),(0,g.jsxs)("div",{className:"flex items-center justify-end mt-4 space-x-3",children:[(0,g.jsx)("button",{onClick:()=>{T({customerName:"",dueDateFrom:"",dueDateTo:"",unpaidAmountMin:"",unpaidAmountMax:"",invoiceNumber:""})},className:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Vymaza\u0165 filtre"}),(0,g.jsxs)("div",{className:"text-sm text-gray-500",children:["Zobrazen\xfdch: ",O.length," z ",C.length]})]})]}),(0,g.jsx)("div",{className:"overflow-x-auto overflow-y-auto",style:{height:"calc(100vh - 500px)",maxHeight:"600px"},children:(0,g.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,g.jsx)("thead",{className:"bg-gray-50",children:(0,g.jsxs)("tr",{children:[(0,g.jsx)("th",{className:"px-6 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"\u010c\xedslo"}),(0,g.jsx)("th",{className:"px-6 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Varsym"}),(0,g.jsx)("th",{className:"px-6 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"D\xe1tum"}),(0,g.jsx)("th",{className:"px-6 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Splatn\xe9"}),(0,g.jsx)("th",{className:"px-6 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Odberate\u013e"}),(0,g.jsx)("th",{className:"px-6 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Celkom"}),(0,g.jsx)("th",{className:"px-6 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Doplatok"}),(0,g.jsx)("th",{className:"px-6 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Akcie"})]})}),(0,g.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:_?(0,g.jsx)("tr",{children:(0,g.jsx)("td",{colSpan:8,className:"px-6 py-4 text-center text-gray-500",children:"Na\u010d\xedtavam fakt\xfary..."})}):0===O.length?(0,g.jsx)("tr",{children:(0,g.jsx)("td",{colSpan:8,className:"px-6 py-4 text-center text-gray-500",children:"\u017diadne fakt\xfary neboli n\xe1jden\xe9"})}):O.map(e=>(0,g.jsxs)("tr",{onClick:()=>(e=>{S(e)})(e),className:"cursor-pointer hover:bg-gray-50 ".concat((null===D||void 0===D?void 0:D.id)===e.id?"bg-blue-50":""),children:[(0,g.jsx)("td",{className:"px-6 py-2 whitespace-nowrap text-sm font-medium text-gray-900",children:e.invoice_number}),(0,g.jsx)("td",{className:"px-6 py-2 whitespace-nowrap text-sm text-gray-500",children:e.varsym||"-"}),(0,g.jsx)("td",{className:"px-6 py-2 whitespace-nowrap text-sm text-gray-500",children:B(e.issue_date)}),(0,g.jsx)("td",{className:"px-6 py-2 whitespace-nowrap text-sm text-gray-500",children:B(e.due_date)}),(0,g.jsx)("td",{className:"px-6 py-2 whitespace-nowrap text-sm text-gray-900",children:e.customer_name}),(0,g.jsx)("td",{className:"px-6 py-2 whitespace-nowrap text-sm text-gray-900",children:H(e.kc_celkem||e.total_amount)}),(0,g.jsx)("td",{className:"px-6 py-2 whitespace-nowrap text-sm text-gray-900",children:H(e.kc_likv||0)}),(0,g.jsx)("td",{className:"px-6 py-2 whitespace-nowrap text-sm text-gray-500",children:(0,g.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,g.jsx)("button",{onClick:t=>{t.stopPropagation(),(e=>{window.location.href="/invoice/issued/".concat(e.id)})(e)},className:"text-blue-600 hover:text-blue-900",title:"Zobrazi\u0165 detail",children:(0,g.jsx)(l.A,{className:"h-4 w-4"})}),(0,g.jsx)("button",{onClick:t=>{t.stopPropagation(),(e=>{console.log("Editova\u0165 fakt\xfaru:",e),alert("Editova\u0165 fakt\xfaru")})(e)},className:"text-blue-600 hover:text-blue-900",title:"Upravi\u0165",children:(0,g.jsx)(u.A,{className:"h-4 w-4"})}),(0,g.jsx)("button",{onClick:t=>{t.stopPropagation(),(async e=>{if(window.confirm("Naozaj chcete vymaza\u0165 fakt\xfaru ".concat(e.invoice_number,"?")))try{await p.B.deleteIssuedInvoice(e.id),await Z()}catch(t){console.error("Chyba pri mazan\xed fakt\xfary:",t),alert("Chyba pri mazan\xed fakt\xfary")}})(e)},className:"text-red-600 hover:text-red-900",title:"Vymaza\u0165",children:(0,g.jsx)(x.A,{className:"h-4 w-4"})})]})})]},e.id))})]})})]})]})})]})}}}]);
//# sourceMappingURL=77.92e040ae.chunk.js.map