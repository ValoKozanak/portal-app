"use strict";(self.webpackChunkclient_portal_frontend=self.webpackChunkclient_portal_frontend||[]).push([[358],{358:(e,t,a)=>{a.r(t),a.d(t,{default:()=>y});var r=a(22555),s=a(9950),n=a(28429),i=a(14185),o=a(50619),l=a(46536),c=a(33695),d=a(39818),m=a(19530),u=a(57491),x=a(16467),p=a(2460),g=a(30017),f=a(12811),h=a(44414);const y=()=>{var e,t;const a=(0,n.Zp)(),y=(0,n.zy)(),{companyId:b}=(0,n.g)(),[v,w]=(0,s.useState)([]),[N]=(0,f.M)("userEmail",""),[j]=(0,f.M)("userRole",null),[k,C]=(0,f.M)("selectedCompanyId",null),[A,D]=(0,s.useState)([]),[S,_]=(0,s.useState)(null),[M,z]=(0,s.useState)(!0),[F,L]=(0,s.useState)(""),[I,E]=(0,s.useState)(!0),[T,Z]=(0,s.useState)(!1),[R,V]=(0,s.useState)({supplierName:"",dueDateFrom:"",dueDateTo:"",unpaidAmountMin:"",unpaidAmountMax:"",invoiceNumber:""});(0,s.useEffect)(()=>{"dividenda"===new URLSearchParams(y.search).get("filter")&&(V(e=>(0,r.A)((0,r.A)({},e),{},{supplierName:"DIVIDENDA s.r.o."})),Z(!0))},[y.search]),(0,s.useEffect)(()=>{j&&N&&P()},[j,N]),(0,s.useEffect)(()=>{b&&!k&&C(Number(b))},[b,k]),(0,s.useEffect)(()=>{k&&(B(),q())},[k]);const P=async()=>{try{let e="".concat("https://api.client-portal.sk","/api/companies");"user"===j?e="".concat("https://api.client-portal.sk","/api/companies/user/").concat(N):"accountant"===j&&(e="/api/companies/accountant/".concat(N));const t=await fetch(e),a=await t.json();w(a),a.length>0&&!b&&!k&&C(a[0].id)}catch(e){console.error("Chyba pri na\u010d\xedtan\xed firiem:",e)}},B=async()=>{if(k)try{z(!0);const e=await p.B.getReceivedInvoices(k,{limit:100});D(e),e.length>0&&_(e[0])}catch(e){console.error("Chyba pri na\u010d\xedtan\xed prijat\xfdch fakt\xfar:",e)}finally{z(!1)}},U=e=>{if(!e||""===e)return"-";try{const t=new Date(e);return isNaN(t.getTime())?"-":t.toLocaleDateString("sk-SK")}catch(t){return"-"}},K=e=>null===e||void 0===e||isNaN(e)?"-":new Intl.NumberFormat("sk-SK",{style:"currency",currency:"EUR"}).format(e),O=A.filter(e=>{var t,a,r,s,n;if(!((null===(t=e.invoice_number)||void 0===t?void 0:t.toLowerCase().includes(F.toLowerCase()))||(null===(a=e.supplier_name)||void 0===a?void 0:a.toLowerCase().includes(F.toLowerCase()))||(null===(r=e.varsym)||void 0===r?void 0:r.toLowerCase().includes(F.toLowerCase()))))return!1;if(R.supplierName&&(null===(s=e.supplier_name)||void 0===s||!s.toLowerCase().includes(R.supplierName.toLowerCase())))return!1;if(R.invoiceNumber&&(null===(n=e.invoice_number)||void 0===n||!n.toLowerCase().includes(R.invoiceNumber.toLowerCase())))return!1;if(R.dueDateFrom){if(new Date(e.due_date)<new Date(R.dueDateFrom))return!1}if(R.dueDateTo){if(new Date(e.due_date)>new Date(R.dueDateTo))return!1}const i=parseFloat(String(e.kc_likv||0))||0;if(R.unpaidAmountMin){if(i<parseFloat(R.unpaidAmountMin))return!1}if(R.unpaidAmountMax){if(i>parseFloat(R.unpaidAmountMax))return!1}return!0}),H=(e,t)=>{V(a=>(0,r.A)((0,r.A)({},a),{},{[e]:t}))},q=async()=>{if(k)try{await p.B.refreshReceivedInvoicesFromMdb(k),await B()}catch(e){console.error("Chyba pri obnoven\xed fakt\xfar:",e),alert("Chyba pri obnoven\xed fakt\xfar")}};return(0,h.jsxs)("div",{className:"min-h-screen bg-gray-50 dark:bg-dark-900",children:[(0,h.jsx)("div",{className:"bg-white dark:bg-dark-800 shadow-sm border-b border-gray-200 dark:border-gray-700",children:(0,h.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,h.jsxs)("div",{className:"flex items-center justify-between h-16",children:[(0,h.jsx)("div",{className:"flex items-center",children:(0,h.jsxs)("button",{onClick:()=>a("/accounting"),className:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[(0,h.jsx)(i.A,{className:"h-4 w-4 mr-2"}),"Sp\xe4\u0165 na \xda\u010dtovn\xedctvo"]})}),(0,h.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,h.jsx)("h1",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Prijat\xe9 fakt\xfary"}),v.length>0&&k&&(0,h.jsxs)("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Firma: ",null===(e=v.find(e=>e.id===k))||void 0===e?void 0:e.name," (I\u010cO: ",null===(t=v.find(e=>e.id===k))||void 0===t?void 0:t.ico,")"]})]})]})})}),(0,h.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:(0,h.jsxs)("div",{className:"flex flex-col min-h-0",children:[I&&(0,h.jsx)("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 border-b border-green-200",children:(0,h.jsx)("div",{className:"p-4",children:(0,h.jsx)(g.A,{invoices:O,type:"received"})})}),(0,h.jsxs)("div",{className:"bg-white overflow-hidden flex flex-col flex-1 min-h-0",children:[(0,h.jsx)("div",{className:"px-6 py-4 border-b border-gray-200 bg-gradient-to-r from-gray-50 to-gray-100 flex-shrink-0",children:(0,h.jsxs)("div",{className:"flex items-center justify-between",children:[(0,h.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,h.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Zoznam prijat\xfdch fakt\xfar"}),(0,h.jsxs)("button",{onClick:()=>Z(!T),className:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md ".concat(T?"text-white bg-green-600 hover:bg-green-700":"text-gray-700 bg-white hover:bg-gray-50"," focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500"),children:[(0,h.jsx)(c.A,{className:"h-4 w-4 mr-2"}),"Filtre"]}),(0,h.jsx)("button",{onClick:()=>E(!I),className:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500",children:I?"Skry\u0165 sum\xe1r":"Zobrazi\u0165 sum\xe1r"}),(0,h.jsxs)("div",{className:"relative",children:[(0,h.jsx)(d.A,{className:"h-5 w-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),(0,h.jsx)("input",{type:"text",placeholder:"H\u013eada\u0165 fakt\xfary...",value:F,onChange:e=>L(e.target.value),className:"pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),(0,h.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,h.jsxs)("button",{onClick:q,className:"inline-flex items-center px-3 py-2 border border-green-300 shadow-sm text-sm leading-4 font-medium rounded-md text-green-700 bg-white hover:bg-green-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500",children:[(0,h.jsx)(o.A,{className:"h-4 w-4 mr-1"}),"Obnovi\u0165"]}),(0,h.jsxs)("button",{onClick:()=>{console.log("Vytvori\u0165 nov\xfa fakt\xfaru"),alert("Vytvori\u0165 nov\xfa fakt\xfaru")},className:"inline-flex items-center px-3 py-2 border border-transparent shadow-sm text-sm leading-4 font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500",children:[(0,h.jsx)(u.A,{className:"h-4 w-4 mr-1"}),"Nov\xe1 fakt\xfara"]})]})]})}),T&&(0,h.jsxs)("div",{className:"px-6 py-4 border-b border-gray-200 bg-gray-50",children:[(0,h.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Dod\xe1vate\u013e"}),(0,h.jsx)("input",{type:"text",value:R.supplierName,onChange:e=>H("supplierName",e.target.value),placeholder:"Zadajte n\xe1zov dod\xe1vate\u013ea...",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500"})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"\u010c\xedslo fakt\xfary"}),(0,h.jsx)("input",{type:"text",value:R.invoiceNumber,onChange:e=>H("invoiceNumber",e.target.value),placeholder:"Zadajte \u010d\xedslo fakt\xfary...",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500"})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Splatn\xe9 od"}),(0,h.jsx)("input",{type:"date",value:R.dueDateFrom,onChange:e=>H("dueDateFrom",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500"})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Splatn\xe9 do"}),(0,h.jsx)("input",{type:"date",value:R.dueDateTo,onChange:e=>H("dueDateTo",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500"})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Doplatok od (\u20ac)"}),(0,h.jsx)("input",{type:"number",step:"0.01",value:R.unpaidAmountMin,onChange:e=>H("unpaidAmountMin",e.target.value),placeholder:"0.00",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500"})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Doplatok do (\u20ac)"}),(0,h.jsx)("input",{type:"number",step:"0.01",value:R.unpaidAmountMax,onChange:e=>H("unpaidAmountMax",e.target.value),placeholder:"999999.99",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500"})]})]}),(0,h.jsxs)("div",{className:"flex items-center justify-end mt-4 space-x-3",children:[(0,h.jsx)("button",{onClick:()=>{V({supplierName:"",dueDateFrom:"",dueDateTo:"",unpaidAmountMin:"",unpaidAmountMax:"",invoiceNumber:""})},className:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500",children:"Vymaza\u0165 filtre"}),(0,h.jsxs)("div",{className:"text-sm text-gray-500",children:["Zobrazen\xfdch: ",O.length," z ",A.length]})]})]}),(0,h.jsx)("div",{className:"flex-1 overflow-x-auto overflow-y-auto",children:(0,h.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,h.jsx)("thead",{className:"bg-gray-50",children:(0,h.jsxs)("tr",{children:[(0,h.jsx)("th",{className:"px-4 py-1 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"\u010c\xedslo"}),(0,h.jsx)("th",{className:"px-4 py-1 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Varsym"}),(0,h.jsx)("th",{className:"px-4 py-1 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"D\xe1tum"}),(0,h.jsx)("th",{className:"px-4 py-1 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Splatn\xe9"}),(0,h.jsx)("th",{className:"px-4 py-1 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Dod\xe1vate\u013e"}),(0,h.jsx)("th",{className:"px-4 py-1 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Celkom"}),(0,h.jsx)("th",{className:"px-4 py-1 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Doplatok"}),(0,h.jsx)("th",{className:"px-4 py-1 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Akcie"})]})}),(0,h.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:M?(0,h.jsx)("tr",{children:(0,h.jsx)("td",{colSpan:8,className:"px-4 py-3 text-center text-gray-500",children:"Na\u010d\xedtavam fakt\xfary..."})}):0===O.length?(0,h.jsx)("tr",{children:(0,h.jsx)("td",{colSpan:8,className:"px-4 py-3 text-center text-gray-500",children:"\u017diadne fakt\xfary neboli n\xe1jden\xe9"})}):O.map(e=>(0,h.jsxs)("tr",{onClick:()=>(e=>{_(e)})(e),className:"cursor-pointer hover:bg-gray-50 ".concat((null===S||void 0===S?void 0:S.id)===e.id?"bg-green-50":""),children:[(0,h.jsx)("td",{className:"px-4 py-1 whitespace-nowrap text-sm font-medium text-gray-900",children:e.invoice_number}),(0,h.jsx)("td",{className:"px-4 py-1 whitespace-nowrap text-sm text-gray-500",children:e.varsym||"-"}),(0,h.jsx)("td",{className:"px-4 py-1 whitespace-nowrap text-sm text-gray-500",children:U(e.issue_date)}),(0,h.jsx)("td",{className:"px-4 py-1 whitespace-nowrap text-sm text-gray-500",children:U(e.due_date)}),(0,h.jsx)("td",{className:"px-4 py-1 whitespace-nowrap text-sm text-gray-900",children:e.supplier_name}),(0,h.jsx)("td",{className:"px-4 py-1 whitespace-nowrap text-sm text-gray-900",children:K(e.kc_celkem||e.total_amount)}),(0,h.jsx)("td",{className:"px-4 py-1 whitespace-nowrap text-sm text-gray-900",children:K(e.kc_likv||0)}),(0,h.jsx)("td",{className:"px-4 py-1 whitespace-nowrap text-sm text-gray-500",children:(0,h.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,h.jsx)("button",{onClick:t=>{t.stopPropagation(),(e=>{window.location.href="/invoice/received/".concat(e.id)})(e)},className:"text-green-600 hover:text-green-900",title:"Zobrazi\u0165 detail",children:(0,h.jsx)(l.A,{className:"h-4 w-4"})}),(0,h.jsx)("button",{onClick:t=>{t.stopPropagation(),(e=>{console.log("Editova\u0165 fakt\xfaru:",e)})(e)},className:"text-green-600 hover:text-green-900",title:"Upravi\u0165",children:(0,h.jsx)(m.A,{className:"h-4 w-4"})}),(0,h.jsx)("button",{onClick:t=>{t.stopPropagation(),(async e=>{if(window.confirm("Naozaj chcete vymaza\u0165 fakt\xfaru ".concat(e.invoice_number,"?")))try{await p.B.deleteReceivedInvoice(e.id),await B()}catch(t){console.error("Chyba pri mazan\xed fakt\xfary:",t),alert("Chyba pri mazan\xed fakt\xfary")}})(e)},className:"text-red-600 hover:text-red-900",title:"Vymaza\u0165",children:(0,h.jsx)(x.A,{className:"h-4 w-4"})})]})})]},e.id))})]})})]})]})})]})}}}]);