"use strict";(self.webpackChunkclient_portal_frontend=self.webpackChunkclient_portal_frontend||[]).push([[672],{17672:(e,t,a)=>{a.r(t),a.d(t,{default:()=>g});var s=a(22555),r=a(9950),n=a(28429),o=a(14185),i=a(50619),l=a(46536),c=a(33695),d=a(39818),u=a(19530),m=a(57491),x=a(16467),p=a(2460),f=a(30017),h=a(12811),b=a(44414);const g=()=>{var e,t;const a=(0,n.Zp)(),{companyId:g}=(0,n.g)(),[y,v]=(0,r.useState)([]),[w]=(0,h.M)("userEmail",""),[N]=(0,h.M)("userRole",null),[j,k]=(0,h.M)("selectedCompanyId",null),[C,A]=(0,r.useState)([]),[D,S]=(0,r.useState)(null),[_,M]=(0,r.useState)(!0),[F,z]=(0,r.useState)(""),[L,I]=(0,r.useState)(!0),[E,T]=(0,r.useState)(!1),[Z,V]=(0,r.useState)({customerName:"",dueDateFrom:"",dueDateTo:"",unpaidAmountMin:"",unpaidAmountMax:"",invoiceNumber:""});(0,r.useEffect)(()=>{N&&w&&B()},[N,w]),(0,r.useEffect)(()=>{g&&!j&&k(Number(g))},[g,j]),(0,r.useEffect)(()=>{j&&(O(),H())},[j]);const B=async()=>{try{let e="".concat("https://api.client-portal.sk","/api/companies");"user"===N?e="".concat("https://api.client-portal.sk","/api/companies/user/").concat(w):"accountant"===N&&(e="/api/companies/accountant/".concat(w));const t=await fetch(e),a=await t.json();v(a),a.length>0&&!g&&!j&&k(a[0].id)}catch(e){console.error("Chyba pri na\u010d\xedtan\xed firiem:",e)}},O=async()=>{if(j)try{M(!0);const e=await p.B.getIssuedInvoices(j,{limit:100});A(e),e.length>0&&S(e[0])}catch(e){console.error("Chyba pri na\u010d\xedtan\xed fakt\xfar:",e)}finally{M(!1)}},P=e=>{if(!e||""===e)return"-";try{const t=new Date(e);return isNaN(t.getTime())?"-":t.toLocaleDateString("sk-SK")}catch(t){return"-"}},K=e=>null===e||void 0===e||isNaN(e)?"-":new Intl.NumberFormat("sk-SK",{style:"currency",currency:"EUR"}).format(e),R=C.filter(e=>{var t,a,s,r,n;if(!((null===(t=e.invoice_number)||void 0===t?void 0:t.toLowerCase().includes(F.toLowerCase()))||(null===(a=e.customer_name)||void 0===a?void 0:a.toLowerCase().includes(F.toLowerCase()))||(null===(s=e.varsym)||void 0===s?void 0:s.toLowerCase().includes(F.toLowerCase()))))return!1;if(Z.customerName&&(null===(r=e.customer_name)||void 0===r||!r.toLowerCase().includes(Z.customerName.toLowerCase())))return!1;if(Z.invoiceNumber&&(null===(n=e.invoice_number)||void 0===n||!n.toLowerCase().includes(Z.invoiceNumber.toLowerCase())))return!1;if(Z.dueDateFrom){if(new Date(e.due_date)<new Date(Z.dueDateFrom))return!1}if(Z.dueDateTo){if(new Date(e.due_date)>new Date(Z.dueDateTo))return!1}const o=parseFloat(String(e.kc_likv||0))||0;if(Z.unpaidAmountMin){if(o<parseFloat(Z.unpaidAmountMin))return!1}if(Z.unpaidAmountMax){if(o>parseFloat(Z.unpaidAmountMax))return!1}return!0}),U=(e,t)=>{V(a=>(0,s.A)((0,s.A)({},a),{},{[e]:t}))},H=async()=>{if(j)try{await p.B.refreshInvoicesFromMdb(j),await O()}catch(e){console.error("Chyba pri obnoven\xed fakt\xfar:",e),alert("Chyba pri obnoven\xed fakt\xfar")}};return(0,b.jsxs)("div",{className:"min-h-screen bg-gray-50 dark:bg-dark-900",children:[(0,b.jsx)("div",{className:"bg-white dark:bg-dark-800 shadow-sm border-b border-gray-200 dark:border-gray-700",children:(0,b.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,b.jsxs)("div",{className:"flex items-center justify-between h-16",children:[(0,b.jsx)("div",{className:"flex items-center",children:(0,b.jsxs)("button",{onClick:()=>a("/accounting"),className:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[(0,b.jsx)(o.A,{className:"h-4 w-4 mr-2"}),"Sp\xe4\u0165 na \xda\u010dtovn\xedctvo"]})}),(0,b.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,b.jsx)("h1",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Vydan\xe9 fakt\xfary"}),y.length>0&&j&&(0,b.jsxs)("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Firma: ",null===(e=y.find(e=>e.id===j))||void 0===e?void 0:e.name," (I\u010cO: ",null===(t=y.find(e=>e.id===j))||void 0===t?void 0:t.ico,")"]})]})]})})}),(0,b.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:(0,b.jsxs)("div",{className:"flex flex-col min-h-0",children:[L&&(0,b.jsx)("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border-b border-blue-200",children:(0,b.jsx)("div",{className:"p-4",children:(0,b.jsx)(f.A,{invoices:R,type:"issued"})})}),(0,b.jsxs)("div",{className:"bg-white overflow-hidden flex flex-col flex-1 min-h-0",children:[(0,b.jsx)("div",{className:"px-6 py-4 border-b border-gray-200 bg-gradient-to-r from-gray-50 to-gray-100 flex-shrink-0",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,b.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Zoznam vydan\xfdch fakt\xfar"}),(0,b.jsxs)("button",{onClick:()=>T(!E),className:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md ".concat(E?"text-white bg-blue-600 hover:bg-blue-700":"text-gray-700 bg-white hover:bg-gray-50"," focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"),children:[(0,b.jsx)(c.A,{className:"h-4 w-4 mr-2"}),"Filtre"]})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,b.jsx)("button",{onClick:()=>I(!L),className:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:L?"Skry\u0165 sum\xe1r":"Zobrazi\u0165 sum\xe1r"}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(d.A,{className:"h-5 w-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),(0,b.jsx)("input",{type:"text",placeholder:"H\u013eada\u0165 fakt\xfary...",value:F,onChange:e=>z(e.target.value),className:"pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsxs)("button",{onClick:H,className:"inline-flex items-center px-3 py-2 border border-blue-300 shadow-sm text-sm leading-4 font-medium rounded-md text-blue-700 bg-white hover:bg-blue-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[(0,b.jsx)(i.A,{className:"h-4 w-4 mr-1"}),"Obnovi\u0165"]}),(0,b.jsxs)("button",{onClick:()=>{console.log("Vytvori\u0165 nov\xfa fakt\xfaru"),alert("Vytvori\u0165 nov\xfa fakt\xfaru")},className:"inline-flex items-center px-3 py-2 border border-transparent shadow-sm text-sm leading-4 font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[(0,b.jsx)(m.A,{className:"h-4 w-4 mr-1"}),"Nov\xe1 fakt\xfara"]})]})]})]})}),E&&(0,b.jsxs)("div",{className:"px-6 py-4 border-b border-gray-200 bg-gray-50",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Firma"}),(0,b.jsx)("input",{type:"text",value:Z.customerName,onChange:e=>U("customerName",e.target.value),placeholder:"Zadajte n\xe1zov firmy...",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"\u010c\xedslo fakt\xfary"}),(0,b.jsx)("input",{type:"text",value:Z.invoiceNumber,onChange:e=>U("invoiceNumber",e.target.value),placeholder:"Zadajte \u010d\xedslo fakt\xfary...",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Splatn\xe9 od"}),(0,b.jsx)("input",{type:"date",value:Z.dueDateFrom,onChange:e=>U("dueDateFrom",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Splatn\xe9 do"}),(0,b.jsx)("input",{type:"date",value:Z.dueDateTo,onChange:e=>U("dueDateTo",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Doplatok od (\u20ac)"}),(0,b.jsx)("input",{type:"number",step:"0.01",value:Z.unpaidAmountMin,onChange:e=>U("unpaidAmountMin",e.target.value),placeholder:"0.00",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Doplatok do (\u20ac)"}),(0,b.jsx)("input",{type:"number",step:"0.01",value:Z.unpaidAmountMax,onChange:e=>U("unpaidAmountMax",e.target.value),placeholder:"999999.99",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]})]}),(0,b.jsxs)("div",{className:"flex items-center justify-end mt-4 space-x-3",children:[(0,b.jsx)("button",{onClick:()=>{V({customerName:"",dueDateFrom:"",dueDateTo:"",unpaidAmountMin:"",unpaidAmountMax:"",invoiceNumber:""})},className:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Vymaza\u0165 filtre"}),(0,b.jsxs)("div",{className:"text-sm text-gray-500",children:["Zobrazen\xfdch: ",R.length," z ",C.length]})]})]}),(0,b.jsx)("div",{className:"flex-1 overflow-x-auto overflow-y-auto",children:(0,b.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,b.jsx)("thead",{className:"bg-gray-50",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"px-4 py-1 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"\u010c\xedslo"}),(0,b.jsx)("th",{className:"px-4 py-1 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Varsym"}),(0,b.jsx)("th",{className:"px-4 py-1 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"D\xe1tum"}),(0,b.jsx)("th",{className:"px-4 py-1 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Splatn\xe9"}),(0,b.jsx)("th",{className:"px-4 py-1 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Odberate\u013e"}),(0,b.jsx)("th",{className:"px-4 py-1 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Celkom"}),(0,b.jsx)("th",{className:"px-4 py-1 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Doplatok"}),(0,b.jsx)("th",{className:"px-4 py-1 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Akcie"})]})}),(0,b.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:_?(0,b.jsx)("tr",{children:(0,b.jsx)("td",{colSpan:8,className:"px-4 py-3 text-center text-gray-500",children:"Na\u010d\xedtavam fakt\xfary..."})}):0===R.length?(0,b.jsx)("tr",{children:(0,b.jsx)("td",{colSpan:8,className:"px-4 py-3 text-center text-gray-500",children:"\u017diadne fakt\xfary neboli n\xe1jden\xe9"})}):R.map(e=>(0,b.jsxs)("tr",{onClick:()=>(e=>{S(e)})(e),className:"cursor-pointer hover:bg-gray-50 ".concat((null===D||void 0===D?void 0:D.id)===e.id?"bg-blue-50":""),children:[(0,b.jsx)("td",{className:"px-4 py-1 whitespace-nowrap text-sm font-medium text-gray-900",children:e.invoice_number}),(0,b.jsx)("td",{className:"px-4 py-1 whitespace-nowrap text-sm text-gray-500",children:e.varsym||"-"}),(0,b.jsx)("td",{className:"px-4 py-1 whitespace-nowrap text-sm text-gray-500",children:P(e.issue_date)}),(0,b.jsx)("td",{className:"px-4 py-1 whitespace-nowrap text-sm text-gray-500",children:P(e.due_date)}),(0,b.jsx)("td",{className:"px-4 py-1 whitespace-nowrap text-sm text-gray-900",children:e.customer_name}),(0,b.jsx)("td",{className:"px-4 py-1 whitespace-nowrap text-sm text-gray-900",children:K(e.kc_celkem||e.total_amount)}),(0,b.jsx)("td",{className:"px-4 py-1 whitespace-nowrap text-sm text-gray-900",children:K(e.kc_likv||0)}),(0,b.jsx)("td",{className:"px-4 py-1 whitespace-nowrap text-sm text-gray-500",children:(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)("button",{onClick:t=>{t.stopPropagation(),(e=>{window.location.href="/invoice/issued/".concat(e.id)})(e)},className:"text-blue-600 hover:text-blue-900",title:"Zobrazi\u0165 detail",children:(0,b.jsx)(l.A,{className:"h-4 w-4"})}),(0,b.jsx)("button",{onClick:t=>{t.stopPropagation(),(e=>{console.log("Editova\u0165 fakt\xfaru:",e),alert("Editova\u0165 fakt\xfaru")})(e)},className:"text-blue-600 hover:text-blue-900",title:"Upravi\u0165",children:(0,b.jsx)(u.A,{className:"h-4 w-4"})}),(0,b.jsx)("button",{onClick:t=>{t.stopPropagation(),(async e=>{if(window.confirm("Naozaj chcete vymaza\u0165 fakt\xfaru ".concat(e.invoice_number,"?")))try{await p.B.deleteIssuedInvoice(e.id),await O()}catch(t){console.error("Chyba pri mazan\xed fakt\xfary:",t),alert("Chyba pri mazan\xed fakt\xfary")}})(e)},className:"text-red-600 hover:text-red-900",title:"Vymaza\u0165",children:(0,b.jsx)(x.A,{className:"h-4 w-4"})})]})})]},e.id))})]})})]})]})})]})}}}]);