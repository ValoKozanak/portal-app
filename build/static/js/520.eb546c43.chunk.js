(self.webpackChunkportal_app=self.webpackChunkportal_app||[]).push([[520],{15340:()=>{},18950:()=>{},21638:()=>{},24538:(e,o,t)=>{"use strict";t.d(o,{A:()=>i});var r=t(53986),a=t(65043);const s=["title","titleId"];function n(e,o){let{title:t,titleId:n}=e,i=(0,r.A)(e,s);return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:o,"aria-labelledby":n},i),t?a.createElement("title",{id:n},t):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))}const i=a.forwardRef(n)},47790:()=>{},51069:()=>{},58799:(e,o,t)=>{"use strict";t.d(o,{A:()=>i});var r=t(53986),a=t(65043);const s=["title","titleId"];function n(e,o){let{title:t,titleId:n}=e,i=(0,r.A)(e,s);return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:o,"aria-labelledby":n},i),t?a.createElement("title",{id:n},t):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 15a4.5 4.5 0 0 0 4.5 4.5H18a3.75 3.75 0 0 0 1.332-7.257 3 3 0 0 0-3.758-3.848 5.25 5.25 0 0 0-10.233 2.33A4.502 4.502 0 0 0 2.25 15Z"}))}const i=a.forwardRef(n)},64688:()=>{},66089:()=>{},73776:()=>{},77098:(e,o,t)=>{"use strict";t.d(o,{A:()=>i});var r=t(53986),a=t(65043);const s=["title","titleId"];function n(e,o){let{title:t,titleId:n}=e,i=(0,r.A)(e,s);return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:o,"aria-labelledby":n},i),t?a.createElement("title",{id:n},t):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))}const i=a.forwardRef(n)},77965:()=>{},78982:()=>{},79316:(e,o,t)=>{"use strict";t.r(o),t.d(o,{default:()=>h});var r=t(65043),a=t(73216),s=t(35475),n=t(24538),i=t(58799),l=t(77098),c=t(90398),d=t(70579);const h=()=>{console.log("=== DropboxCallback komponent sa na\u010d\xedtal ==="),console.log("URL:",window.location.href),console.log("Search params:",window.location.search);const e=(0,a.Zp)(),[o]=(0,s.ok)(),[t,h]=(0,r.useState)("idle"),[p,u]=(0,r.useState)(""),b=(0,r.useRef)(!1);(0,r.useEffect)(()=>{console.log("DropboxCallback useEffect - za\u010diatok"),"idle"!==t||b.current||x()},[t]);const x=async()=>{if(b.current||"idle"!==t)console.log("Callback u\u017e sa spracov\xe1va alebo bol dokon\u010den\xfd, ignorujem...");else{b.current=!0;try{console.log("Spracov\xe1vam Dropbox callback..."),h("loading");const t=o.get("code"),r=o.get("state"),a=o.get("error");if(console.log("Callback parametre:",{code:t,state:r,error:a}),a)return console.error("Dropbox callback error:",a),h("error"),void u("Chyba pri autentifik\xe1cii: ".concat(a));if(!t||!r)return console.error("Ch\xfdbaj\xface parametre:",{code:t,state:r}),h("error"),void u("Ch\xfdbaj\xface parametre pre autentifik\xe1ciu");console.log("Spracov\xe1vam OAuth callback..."),await c.k.handleAuthCallback(t,r),console.log("OAuth callback \xfaspe\u0161n\xfd!"),h("success"),u("\xdaspe\u0161ne ste sa prihl\xe1sili k Dropbox!"),setTimeout(()=>{console.log("Presmerov\xe1vam sp\xe4\u0165 na dashboard s URL parametrom..."),e("/dashboard?from_callback=true")},2e3)}catch(r){console.error("Error during Dropbox callback:",r),h("error"),u("Chyba pri pripojen\xed k Dropbox. Sk\xfaste to znova.")}finally{b.current=!1}}};return(0,d.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,d.jsx)("div",{className:"max-w-md w-full bg-white rounded-lg shadow-md p-8",children:(0,d.jsxs)("div",{className:"text-center",children:["loading"===t&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,d.jsx)(i.A,{className:"mx-auto h-8 w-8 text-blue-500 mb-4"}),(0,d.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Prip\xe1janie k Dropbox..."}),(0,d.jsx)("p",{className:"text-gray-600",children:"Spracov\xe1vame va\u0161u autentifik\xe1ciu"})]}),"success"===t&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(n.A,{className:"mx-auto h-12 w-12 text-green-500 mb-4"}),(0,d.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"\xdaspe\u0161ne pripojen\xe9!"}),(0,d.jsx)("p",{className:"text-gray-600 mb-4",children:p}),(0,d.jsx)("p",{className:"text-sm text-gray-500",children:"Presmerov\xe1vam v\xe1s sp\xe4\u0165..."})]}),"error"===t&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(l.A,{className:"mx-auto h-12 w-12 text-red-500 mb-4"}),(0,d.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Chyba pripojenia"}),(0,d.jsx)("p",{className:"text-gray-600 mb-4",children:p}),(0,d.jsx)("button",{onClick:()=>e(-1),className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Sp\xe4\u0165"})]})]})})})}},79368:()=>{},79838:()=>{},90398:(e,o,t)=>{"use strict";t.d(o,{k:()=>i});var r=t(89874);const a="aw4ioyb0u4dbis4",s="ub03kukj9sx6fta",n="http://localhost:3000/dropbox-callback";const i=new class{constructor(){this.dbx=null,this.accessToken=null,console.log("DropboxService: Inicializujem..."),console.log("DropboxService: Environment premenn\xe9:",{appKey:a,appSecret:s?"***":"CH\xddBA",appSecretLength:s?15:0,redirectUri:n}),this.accessToken=localStorage.getItem("dropbox_access_token"),console.log("DropboxService: Token z localStorage:",this.accessToken?"existuje":"neexistuje"),this.accessToken?(this.initializeDropbox(this.accessToken),console.log("DropboxService: Dropbox klient inicializovan\xfd")):console.log("DropboxService: \u017diadny token, Dropbox klient nie je inicializovan\xfd")}initializeDropbox(e){this.dbx=new r.Dropbox({accessToken:e,fetch:window.fetch.bind(window)})}getAuthUrl(){localStorage.removeItem("dropbox_auth_state");const e=Math.random().toString(36).substring(7);localStorage.setItem("dropbox_auth_state",e),console.log("DropboxService.getAuthUrl - konfigur\xe1cia:",{appKey:a,redirectUri:n,state:e,timestamp:(new Date).toISOString()});const o="https://www.dropbox.com/oauth2/authorize?client_id=".concat(a,"&response_type=code&redirect_uri=").concat(encodeURIComponent(n),"&state=").concat(e,"&token_access_type=offline");return console.log("DropboxService.getAuthUrl - vygenerovan\xfd URL:",o),o}async handleAuthCallback(e,o){console.log("dropboxService.handleAuthCallback - za\u010diatok"),console.log("Parametre:",{code:e.substring(0,10)+"...",state:o});const t=localStorage.getItem("dropbox_auth_state");if(console.log("Ulo\u017een\xfd state:",t),console.log("State porovnanie:",{received:o,saved:t,match:o===t}),o!==t)throw console.error("State nezhoduje:",{received:o,saved:t}),console.error("V\u0161etky localStorage polo\u017eky:",{dropbox_auth_state:localStorage.getItem("dropbox_auth_state"),dropbox_access_token:localStorage.getItem("dropbox_access_token"),dropbox_refresh_token:localStorage.getItem("dropbox_refresh_token")}),new Error("Invalid state parameter");console.log("State kontrola \xfaspe\u0161n\xe1, pokra\u010dujem v spracovan\xed...");try{console.log("Posielam po\u017eiadavku na Dropbox API..."),console.log("DropboxService.handleAuthCallback - parametre pre API:",{code:e.substring(0,10)+"...",client_id:a,client_secret:s?"***":"CH\xddBA",redirect_uri:n});const o=new URLSearchParams({code:e,grant_type:"authorization_code",client_id:a,client_secret:s,redirect_uri:n});console.log("DropboxService.handleAuthCallback - request body:",o.toString());const t=await window.fetch("https://api.dropboxapi.com/oauth2/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:o});if(console.log("Dropbox API response status:",t.status),!t.ok){const e=await t.text();throw console.error("Dropbox API error:",e),console.error("Dropbox API response headers:",Object.fromEntries(t.headers.entries())),new Error("Failed to exchange code for token: ".concat(e))}const r=await t.json();return console.log("Dropbox API \xfaspe\u0161n\xe1 odpove\u010f:",{access_token:r.access_token.substring(0,10)+"...",token_type:r.token_type,expires_in:r.expires_in}),this.accessToken=r.access_token,localStorage.setItem("dropbox_access_token",r.access_token),r.refresh_token&&localStorage.setItem("dropbox_refresh_token",r.refresh_token),localStorage.removeItem("dropbox_auth_state"),console.log("State vy\u010disten\xfd po \xfaspe\u0161nom spracovan\xed"),console.log("Tokeny ulo\u017een\xe9 do localStorage"),this.initializeDropbox(r.access_token),console.log("Dropbox klient inicializovan\xfd"),r}catch(r){throw console.error("Error during OAuth callback:",r),r}}isAuthenticated(){const e=localStorage.getItem("dropbox_access_token");e&&!this.accessToken&&(this.accessToken=e,this.initializeDropbox(e),console.log("DropboxService.isAuthenticated: Reinicializoval klienta z localStorage"));const o=null!==this.dbx&&null!==this.accessToken;return console.log("DropboxService.isAuthenticated:",{dbx:null!==this.dbx,accessToken:null!==this.accessToken,tokenFromStorage:e?"existuje":"neexistuje",result:o}),o}logout(){this.dbx=null,this.accessToken=null,localStorage.removeItem("dropbox_access_token"),localStorage.removeItem("dropbox_refresh_token"),localStorage.removeItem("dropbox_auth_state")}async getAccountInfo(){if(!this.dbx)throw new Error("Dropbox not initialized");try{if(console.log("DropboxService.getAccountInfo - vol\xe1m Dropbox API..."),!this.dbx.usersGetCurrentAccount)throw new Error("Dropbox client not properly initialized");if(!this.dbx.usersGetCurrentAccount)throw console.error("Dropbox client methods not available"),new Error("Dropbox client methods not available");const e=await this.dbx.usersGetCurrentAccount();return console.log("DropboxService.getAccountInfo - odpove\u010f:",e),e.result}catch(e){if(console.error("Error getting account info:",e),e instanceof Error&&(e.message.includes("fetch")||e.message.includes("Illegal invocation"))){console.log("DropboxService.getAccountInfo - probl\xe9m s fetch, reinicializujem klienta...");const e=localStorage.getItem("dropbox_access_token");if(e){this.initializeDropbox(e);const o=await this.dbx.usersGetCurrentAccount();return console.log("DropboxService.getAccountInfo - reinicializ\xe1cia \xfaspe\u0161n\xe1:",o),o.result}}throw e}}async listFiles(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",o=arguments.length>1?arguments[1]:void 0;if(!this.dbx)throw new Error("Dropbox not initialized");try{console.log("=== DROPBOX SERVICE DEBUG ==="),console.log("DropboxService.listFiles - za\u010diatok"),console.log("DropboxService.listFiles - path:",e),console.log("DropboxService.listFiles - ico:",o),console.log("DropboxService.listFiles - this.dbx exists:",!!this.dbx);let t=e;if(o&&!e.startsWith("/Portal/Companies/")){const r=this.getCompanyFolderPath(o);t=r+(e?"/"+e:""),console.log("DropboxService.listFiles - companyFolder:",r)}console.log("DropboxService.listFiles - targetPath:",t),console.log("DropboxService.listFiles - vol\xe1m this.dbx.filesListFolder...");const r=await this.dbx.filesListFolder({path:t,limit:100});console.log("DropboxService.listFiles - response received");return r.result.entries.map(e=>({id:"deleted"===e[".tag"]?"":e.id||"",name:e.name,path_lower:e.path_lower||"",size:"file"===e[".tag"]&&e.size||0,server_modified:"file"===e[".tag"]&&e.server_modified||"",content_hash:"file"===e[".tag"]&&e.content_hash||"",tag:e[".tag"]}))}catch(t){throw console.error("DropboxService.listFiles - ERROR:",t),t instanceof Error&&(console.error("DropboxService.listFiles - error.message:",t.message),console.error("DropboxService.listFiles - error.stack:",t.stack)),t}}getCompanyFolderPath(e){const o=this.hashICO(e);return"/Portal/Companies/".concat(o)}hashICO(e){return e.replace(/\s/g,"").replace(/[^a-zA-Z0-9]/g,"")}async createCompanyFolder(e){if(!this.dbx)throw new Error("Dropbox not initialized");try{const o=this.getCompanyFolderPath(e);await this.dbx.filesCreateFolderV2({path:o,autorename:!1});return o}catch(o){throw console.error("Error creating company folder:",o),o}}async getCompanySharedLink(e){if(!this.dbx)throw new Error("Dropbox not initialized");try{const o=this.getCompanyFolderPath(e);return await this.getSharedLink(o)}catch(o){throw console.error("Error getting company shared link:",o),o}}async uploadFile(e,o,t,r){if(!this.dbx)throw new Error("Dropbox not initialized");try{const r=await e.arrayBuffer();let a=o+"/"+e.name;if(t&&!o.startsWith("/Portal/Companies/")){const r=this.getCompanyFolderPath(t);a=r+"/"+(o?o+"/":"")+e.name,console.log("DropboxService.uploadFile - companyFolder:",r)}console.log("DropboxService.uploadFile - fullPath:",a);const s=await this.dbx.filesUpload({path:a,contents:r,mode:{".tag":"overwrite"},autorename:!0,mute:!1});return console.log("DropboxService.uploadFile - upload response:",s),{id:s.result.id,name:s.result.name,path_lower:s.result.path_lower||"",size:s.result.size,server_modified:s.result.server_modified}}catch(a){throw console.error("Error uploading file:",a),a}}async downloadFile(e){if(!this.dbx)throw new Error("Dropbox not initialized");try{const o=(await this.dbx.filesDownload({path:e})).result.fileBlob;return new Blob([o],{type:o.type||"application/octet-stream"})}catch(o){throw console.error("Error downloading file:",o),o}}async deleteFile(e){if(!this.dbx)throw new Error("Dropbox not initialized");try{await this.dbx.filesDeleteV2({path:e})}catch(o){throw console.error("Error deleting file:",o),o}}async createFolder(e){if(!this.dbx)throw new Error("Dropbox not initialized");try{await this.dbx.filesCreateFolderV2({path:e,autorename:!0})}catch(o){throw console.error("Error creating folder:",o),o}}async getSharedLink(e){if(!this.dbx)throw new Error("Dropbox not initialized");try{return(await this.dbx.sharingCreateSharedLinkWithSettings({path:e,settings:{requested_visibility:{".tag":"public"},audience:{".tag":"public"},access:{".tag":"viewer"}}})).result.url}catch(o){throw console.error("Error creating shared link:",o),o}}async refreshAccessToken(){const e=localStorage.getItem("dropbox_refresh_token");if(!e)throw new Error("No refresh token available");try{const o=await window.fetch("https://api.dropboxapi.com/oauth2/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({grant_type:"refresh_token",refresh_token:e,client_id:a,client_secret:s})});if(!o.ok)throw new Error("Failed to refresh token");const t=await o.json();return this.accessToken=t.access_token,localStorage.setItem("dropbox_access_token",t.access_token),this.initializeDropbox(t.access_token),t.access_token}catch(o){throw console.error("Error refreshing token:",o),o}}async createSharedLink(e,o){if(!this.dbx)throw new Error("Dropbox not initialized");try{console.log("DropboxService.createSharedLink - vytv\xe1ram link pre:",e),console.log("DropboxService.createSharedLink - opr\xe1vnenia:",o);let t={".tag":"viewer"};(o.canEdit||o.canUpload||o.canDelete)&&(t={".tag":"editor"}),console.log("DropboxService.createSharedLink - access level:",t);const r=await this.dbx.sharingCreateSharedLinkWithSettings({path:e,settings:{requested_visibility:{".tag":"public"},audience:{".tag":"public"},access:t}});return console.log("DropboxService.createSharedLink - \xfaspe\u0161ne vytvoren\xfd link:",r.result.url),r.result.url}catch(t){if(console.error("Error creating shared link with permissions:",t),t instanceof Error&&(t.message.includes("shared_link_already_exists")||t.message.includes("409"))){console.log("Link u\u017e existuje (409), z\xedskavam existuj\xfaci link...");try{const o=await this.dbx.sharingListSharedLinks({path:e,direct_only:!1});if(o.result.links.length>0)return console.log("Na\u0161iel som existuj\xfaci link:",o.result.links[0].url),o.result.links[0].url}catch(r){console.error("Chyba pri z\xedskavan\xed existuj\xfaceho linku:",r)}}throw t}}async revokeSharedLink(e){if(!this.dbx)throw new Error("Dropbox not initialized");try{console.log("DropboxService.revokeSharedLink - odvol\xe1vam link:",e),await this.dbx.sharingRevokeSharedLink({url:e}),console.log("DropboxService.revokeSharedLink - link \xfaspe\u0161ne odvolan\xfd")}catch(o){if(console.error("Error revoking shared link:",o),o instanceof Error&&o.message.includes("not_found"))return void console.log("Link u\u017e neexistuje, pova\u017eujem za \xfaspe\u0161ne odvolan\xfd");throw o}}async getAllSharedLinks(){if(!this.dbx)throw new Error("Dropbox not initialized");try{console.log("DropboxService.getAllSharedLinks - z\xedskavam v\u0161etky zdie\u013eate\u013en\xe9 linky...");const e=await this.dbx.sharingListSharedLinks({path:"/Portal/Companies",direct_only:!1});return console.log("DropboxService.getAllSharedLinks - na\u010d\xedtan\xe9 linky:",e.result.links),e.result.links}catch(e){throw console.error("Error getting shared links:",e),e}}async checkFolderExists(e){if(!this.dbx)throw new Error("Dropbox not initialized");try{console.log("DropboxService.checkFolderExists - kontrolujem zlo\u017eku:",e);const o=await this.dbx.filesGetMetadata({path:e});return console.log("DropboxService.checkFolderExists - zlo\u017eka existuje:",o),"folder"===o.result[".tag"]}catch(o){return console.log("DropboxService.checkFolderExists - zlo\u017eka neexistuje:",o),!1}}}},92668:()=>{}}]);
//# sourceMappingURL=520.eb546c43.chunk.js.map